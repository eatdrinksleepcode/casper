#! /bin/sh

myDir="`dirname \"$0\"`"
localNugetConfig=$myDir/.local-nuget.config
cp $myDir/local-nuget.config $localNugetConfig

$myDir/build Debug || exit $?
rm -r $myDir/.msbuild
mkdir $myDir/.msbuild
echo "Installing casper..."
packageDir="$(cd $myDir/out/packages; pwd)"
$myDir/nuget sources Remove -Name "Casper Dev" -ConfigFile $localNugetConfig > /dev/null 2>&1
$myDir/nuget sources Add -Name "Casper Dev" -Source "$packageDir" -ConfigFile $localNugetConfig > /dev/null || exit $?
$myDir/nuget install Casper.Console -OutputDirectory $myDir/.msbuild -pre -Verbosity quiet -Source "Casper Dev" -ConfigFile $localNugetConfig || exit $?
echo Cleaning outputs...
msbuild /t:Clean /verbosity:quiet /nologo || exit $?
msbuild /t:Clean /p:Configuration=Release /verbosity:quiet /nologo || exit $?
$myDir/build-with-casper $@ || exit $?
